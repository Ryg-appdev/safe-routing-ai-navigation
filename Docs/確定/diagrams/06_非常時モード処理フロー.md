# 非常時モード処理フロー

**コンセプト**: 気象警報の種類に応じて、該当リスクのみを評価

```mermaid
flowchart TD
    A["リクエスト受信"] --> B["気象警報チェック<br/>OpenWeatherMap alerts"]
    
    B --> C{"警報の種類?"}
    
    C -->|"大雨・洪水警報"| D1["🌧️ 浸水リスク評価<br/>洪水ハザードマップ照合"]
    C -->|"土砂災害警戒情報"| D2["🌊 土砂災害リスク評価<br/>土砂ハザードマップ照合"]
    C -->|"津波警報"| D3["🌊 津波リスク評価<br/>津波ハザードマップ照合"]
    C -->|"警報なし"| D4["通常モードへ"]
    
    D1 --> E["危険エリア特定"]
    D2 --> E
    D3 --> E
    
    E --> F["回避ルート検索"]
    F --> G{"安全ルート<br/>あり?"}
    
    G -->|"Yes"| H["最安全ルート選択"]
    G -->|"No"| I["🔄 自律リトライ"]
    
    I --> J["安全地点をWaypoint設定"]
    J --> F
    
    H --> K["緊急ナレーション生成"]
    K --> L["レスポンス返却"]
```

## 警報とリスクの対応表
| 警報種別 | チェックするリスク | データソース |
| :--- | :--- | :--- |
| 大雨警報・洪水警報 | 浸水（洪水） | 洪水浸水想定区域 |
| 土砂災害警戒情報 | 土砂災害 | 土砂災害警戒区域 |
| 津波警報・大津波警報 | 津波 | 津波浸水想定区域 |

## ポイント
- **無駄なAPI呼び出しを削減**: 関連するリスクのみを評価
- **レスポンス速度向上**: 不要なハザードマップ照合をスキップ
