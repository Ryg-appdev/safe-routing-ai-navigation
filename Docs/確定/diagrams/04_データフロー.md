# ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

## å…¨ä½“ãƒ•ãƒ­ãƒ¼
```mermaid
flowchart TB
    subgraph Client["ğŸ“± iOS App"]
        UI["SwiftUI View"]
        VM["ViewModel"]
        APIClient["API Client"]
    end

    subgraph Backend["â˜ï¸ Cloud Functions"]
        Handler["Request Handler"]
        
        subgraph Agents["Agentic Flow"]
            Input["Input Agent"]
            Risk["Risk Evaluator"]
            Route["Route Selector"]
            Narr["Narrator"]
        end
    end

    subgraph ExternalAPIs["ğŸŒ External APIs"]
        Weather["OpenWeatherMap"]
        Hazard["ãƒã‚¶ãƒ¼ãƒ‰ãƒãƒƒãƒ—"]
        Police["è­¦è¦–åºçµ±è¨ˆ"]
        Routes["Google Routes API"]
        SV["Street View API"]
    end

    UI -->|"ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ"| VM
    VM -->|"RouteRequest"| APIClient
    APIClient -->|"POST /findSafeRoute"| Handler
    
    Handler --> Input
    Input -->|"æ°—è±¡å–å¾—"| Weather
    Input -->|"ç½å®³æƒ…å ±å–å¾—"| Hazard
    Input -->|"æ²»å®‰æƒ…å ±å–å¾—"| Police
    
    Input --> Risk
    Risk -->|"ãƒªã‚¹ã‚¯è©•ä¾¡"| Route
    Route -->|"ãƒ«ãƒ¼ãƒˆæ¤œç´¢"| Routes
    Route --> Narr
    
    Narr -->|"RouteResponse"| Handler
    Handler -->|"JSON Response"| APIClient
    APIClient --> VM --> UI
    
    Risk -.->|"éåŒæœŸ"| SV
```

## ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ 
```mermaid
flowchart LR
    subgraph Response["RouteResponse"]
        R["routes[]"]
        N["narrative"]
        L["thinkingLog[]"]
        RA["riskAssessment"]
    end
    
    subgraph Route["SafeRoute"]
        P["polyline"]
        S["safetyScore"]
        W["warnings[]"]
    end
    
    R --> Route
```
