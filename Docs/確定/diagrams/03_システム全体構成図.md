# ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆå›³

```mermaid
flowchart TB
    subgraph Client [ğŸ“± Mobile Client]
        iOS[iOS App (SwiftUI)]
        MapsSDK[Google Maps SDK]
        GPS[Location Manager]
        iOS --> MapsSDK
        iOS --> GPS
    end

    subgraph Backend [â˜ï¸ Google Cloud / Firebase]
        Genkit[Firebase Genkit (Node.js)]
        Functions[Cloud Functions]
        Firestore[(Firestore: Logs)]
        
        iOS -- "POST /findSafeRoute" --> Functions
        Functions --> Genkit
        Genkit -- "Log History" --> Firestore
    end

    subgraph Agents [ğŸ¤– Agentic Workflow]
        InputAgent[Input Agent<br/>(Context Gathering)]
        RiskAgent[Risk Evaluator<br/>(Gemini 3 Reasoning)]
        RouteAgent[Route Selector<br/>(Autonomous Retry)]
        VisionAgent[Visual Analyst<br/>(Gemini Pro Vision)]
        Narrator[Narrator Agent<br/>(Explanation)]

        Genkit --> InputAgent
        InputAgent --> RiskAgent
        RiskAgent --> RouteAgent
        RouteAgent -- "If risky" --> RouteAgent
        RouteAgent --> Narrator
        
        Genkit -.-> VisionAgent
    end

    subgraph APIs [ğŸŒ External Data Sources]
        direction LR
        WeatherAPI[OpenWeatherMap API<br/>(Rain/Wind)]
        HazardAPI[å›½åœŸäº¤é€šçœãƒã‚¶ãƒ¼ãƒ‰ãƒãƒƒãƒ—<br/>(Tile Data)]
        PoliceData[è­¦è¦–åºçµ±è¨ˆãƒ‡ãƒ¼ã‚¿<br/>(CSV/Static)]
        RoutesAPI[Google Routes API]
        StreetView[Street View Static API]

        InputAgent <--> WeatherAPI
        InputAgent <--> HazardAPI
        InputAgent <--> PoliceData
        RouteAgent <--> RoutesAPI
        VisionAgent <--> StreetView
    end
```
