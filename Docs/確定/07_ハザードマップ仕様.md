# 07_ハザードマップ表示仕様

本ドキュメントでは、地図上にオーバーレイ表示するハザードマップの仕様を定義する。

## 概要
Google Maps 上に国土地理院の「重ねるハザードマップ」タイルを半透明で重ねて表示し、ユーザーが直感的に危険エリアを把握できるようにする。

## 1. タイルデータソース
国土地理院 (GSI) のオープンデータを使用する。

### 1-1. 洪水浸水想定区域 (想定最大規模)
- **URL**: `https://disaportaldata.gsi.go.jp/raster/01_flood_l2_shinsuishin_data/{z}/{x}/{y}.png`
- **用途**: 大雨、台風、洪水時

### 1-2. 土砂災害警戒区域
- **URL**: `https://disaportaldata.gsi.go.jp/raster/05_dosha_keikai_data/{z}/{x}/{y}.png`
- **用途**: 大雨、台風、土砂災害時

### 1-3. 津波浸水想定
- **URL**: `https://disaportaldata.gsi.go.jp/raster/04_tsunami_newlegend_data/{z}/{x}/{y}.png`
- **用途**: 津波警報・注意報発令時

### 1-4. 高潮浸水想定区域
- **URL**: `https://disaportaldata.gsi.go.jp/raster/03_hightide_l2_shinsuishin_data/{z}/{x}/{y}.png`
- **用途**: 台風（高潮警報）時

## 2. 表示ロジック

### 2-1. トリガー条件と表示マッピング
UI上に表示される5つの警報種別 (`effectiveAlertProvider`) に基づき、表示するハザードマップを決定する。

| UI表示の警報名 | 内部タイプ (API) | 表示するハザードマップ | 理由 |
|---|---|---|---|
| **大雨警報** | `RAIN` | 洪水 + 土砂災害 | 大雨は河川氾濫と土砂崩れの両方のリスクを高めるため。 |
| **洪水警報** | `FLOOD` | 洪水 | 河川の氾濫リスクを可視化するため。 |
| **津波警報** | `TSUNAMI` | 津波 | 津波による浸水想定エリアを回避するため。 |
| **土砂災害警戒情報** | `LANDSLIDE` | 土砂災害 | 崖崩れや土石流の危険エリアを可視化するため。 |
| **地震情報** | `EARTHQUAKE` | (表示なし) | **【重要】現状の制限事項**: <br>地震発生時、UIは緊急モード（赤）に切り替わるが、**倒壊や火災リスクに基づくルート回避判定は行われない**（ロジック未実装のため）。<br>※ Phase 4以降で幅員優先探索等のロジックを実装するまで、この制限は有効である。 |

※ 高潮警報は現状UIに含まれていないため、実装対象外とする。

### 2-2. 表示スタイル
- **Opacity (不透明度)**: 
  - 単体表示時: `0.5`
  - 複数表示時 (大雨など): 各 `0.35` (重なった部分が濃くなるように調整)
- **Z-Index**: Google Maps のベースマップより上、ルート (`Polyline`) より下。

## 3. 実装方針 (Flutter)
- `google_maps_flutter` パッケージの `TileOverlay` 機能を使用する。
- `UrlTileProvider` を継承したカスタムプロバイダ (`HazardTileProvider`) を実装し、動的にURLを切り替えられるようにする。
